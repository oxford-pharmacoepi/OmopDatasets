---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# OmopDatasets

<!-- badges: start -->
[![R-CMD-check](https://github.com/oxford-pharmacoepi/OmopDatasets/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/oxford-pharmacoepi/OmopDatasets/actions/workflows/R-CMD-check.yaml)
[![CRAN status](https://www.r-pkg.org/badges/version/OmopDatasets)](https://CRAN.R-project.org/package=OmopDatasets)
<!-- badges: end -->

The goal of OmopDatasets is an R packages that allowa you to **download**, **export** and **connect** to synthetic sample datasets mapped to the Observational Medical Outcomes Partnership (OMOP) Common Data Model (CDM).

## Installation

You can install `OmopDatasets` from cran:

```{r, eval=FALSE}
install.packages("OmopDatasets")
```

Or you can install the development version of `OmopDatasets` from [GitHub](https://github.com/oxford-pharmacoepi/OmopDatasets) with:

```{r, eval=FALSE}
# install.packages("pak")
pak::pkg_install("oxford-pharmacoepi/OmopDatasets")
```

## Example

This is a simple example how to start working with one of our synthetic OMOP CDM Datasets:

1. Choose the dataset you want to use from the list of `availableDatasets()`:

```{r}
library(OmopDatasets)
availableDatasets()
```

2. Download the dataset that you are interested on:

```{r}
downloadDataset(datasetName = "GiBleed")
```

3. Get your cdm_reference object (see [omopgenerics](https://darwin-eu.github.io/omopgenerics/)) from the dataset:

```{r}
cdm <- cdmFromDataset(datasetName = "GiBleed")
cdm
```

This function creates a *temporary* cdm_reference, if you want to export the database to a duckdb container you can use instead:

```{r}
pathToExport <- file.path(tempdir(), "my_db")
dir.create(pathToExport)
exportDatasetToDuckdb(path = pathToExport, datasetName = "GiBleed")
```

You can then create a cdm_reference object using [CDMConnector](https://darwin-eu.github.io/CDMConnector/):

```{r}
library(duckdb)
library(CDMConnector)

con <- dbConnect(drv = duckdb(dbdir = file.path(pathToExport, "GiBleed.duckdb")))
cdm <- cdmFromCon(con = con, cdmSchema = "main", writeSchema = "results")
```
