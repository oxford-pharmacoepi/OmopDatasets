<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Manage sample OMOP CDM Datasets • OmopDatasets</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Manage sample OMOP CDM Datasets">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OmopDatasets</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/omop_datasets.html">Manage sample OMOP CDM Datasets</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Manage sample OMOP CDM Datasets</h1>
            
      

      <div class="d-none name"><code>omop_datasets.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="set-up">Set up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>The package <strong>OmopDatasets</strong> allows you to manage a
total of <strong>24</strong> different OMOP CDM sample datasets:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oxford-pharmacoepi.github.io/OmopDatasets/">OmopDatasets</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/availableDatasets.html">availableDatasets</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "GiBleed"                             "empty_cdm"                          </span></span>
<span><span class="co">#&gt;  [3] "synpuf-1k_5.3"                       "synpuf-1k_5.4"                      </span></span>
<span><span class="co">#&gt;  [5] "synthea-allergies-10k"               "synthea-anemia-10k"                 </span></span>
<span><span class="co">#&gt;  [7] "synthea-breast_cancer-10k"           "synthea-contraceptives-10k"         </span></span>
<span><span class="co">#&gt;  [9] "synthea-covid19-10k"                 "synthea-covid19-200k"               </span></span>
<span><span class="co">#&gt; [11] "synthea-dermatitis-10k"              "synthea-heart-10k"                  </span></span>
<span><span class="co">#&gt; [13] "synthea-hiv-10k"                     "synthea-lung_cancer-10k"            </span></span>
<span><span class="co">#&gt; [15] "synthea-medications-10k"             "synthea-metabolic_syndrome-10k"     </span></span>
<span><span class="co">#&gt; [17] "synthea-opioid_addiction-10k"        "synthea-rheumatoid_arthritis-10k"   </span></span>
<span><span class="co">#&gt; [19] "synthea-snf-10k"                     "synthea-surgery-10k"                </span></span>
<span><span class="co">#&gt; [21] "synthea-total_joint_replacement-10k" "synthea-veteran_prostate_cancer-10k"</span></span>
<span><span class="co">#&gt; [23] "synthea-veterans-10k"                "synthea-weight_loss-10k"</span></span></code></pre></div>
<p>These datasets are downloaded by default to temporary library which
means they will only be available during the duration of the session and
won’t be available afterwards.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/datasetsFolder.html">datasetsFolder</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmprU1Mm3"</span></span></code></pre></div>
<p>You can set the folder where datasets are stored using the
<code><a href="../reference/datasetsFolder.html">datasetsFolder()</a></code> function, but this will also only be
<em>temporary</em> and for the current R session.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/datasetsFolder.html">datasetsFolder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"FOLDER_WITH_DATASETS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Creating <span style="color: #0000BB;">/tmp/Rtmph7LNiC/FOLDER_WITH_DATASETS</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> If you want to create a permanent `OMOP_DATASETS_FOLDER` write the following</span></span>
<span><span class="co">#&gt;   in your `.Renviron` file:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   <span style="color: #0000BB;">OMOP_DATASETS_FOLDER</span>="/tmp/Rtmph7LNiC/FOLDER_WITH_DATASETS"</span></span></code></pre></div>
<p>So we would recommend that the first thing you must do is to create a
folder where you want to store the OMOP CDM sample datasets and save it
in the .Renviron for a <em>permanent</em> location.</p>
<ol style="list-style-type: decimal">
<li><p>Create a folder where you want to store the datasets. It does not
have to be nested inside your project.</p></li>
<li><p>Open the .Renviron file (<code>usethis::edit_r_environ()</code>)
and save your location:</p></li>
</ol>
<pre><code><span><span class="va">OMOP_DATASETS_FOLDER</span><span class="op">=</span><span class="st">"path/to/my/folder"</span></span></code></pre>
<ol start="3" style="list-style-type: decimal">
<li><p>Restart your R session.</p></li>
<li><p>Check that the process worked, if so you should be able to
see:</p></li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/datasetsFolder.html">datasetsFolder</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "path/to/my/folder"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download-dataset">Download dataset<a class="anchor" aria-label="anchor" href="#download-dataset"></a>
</h2>
<p>You can easily check if a dataset is downloaded using the utility
function <code><a href="../reference/isDatasetDownloaded.html">isDatasetDownloaded()</a></code>, for example in this case we
can see that <em>GiBleed</em> dataset is not download:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/isDatasetDownloaded.html">isDatasetDownloaded</a></span><span class="op">(</span>datasetName <span class="op">=</span> <span class="st">"GiBleed"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>You can download one of the OMOP CDM sample datasets with:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/downloadDataset.html">downloadDataset</a></span><span class="op">(</span>datasetName <span class="op">=</span> <span class="st">"GiBleed"</span><span class="op">)</span></span></code></pre></div>
<p>Then you can now check that the database was successfully
downloaded:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/isDatasetDownloaded.html">isDatasetDownloaded</a></span><span class="op">(</span>datasetName <span class="op">=</span> <span class="st">"GiBleed"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>If you want to overwrite the dataset you can download it again with
the <code>overwrite = TRUE</code> parameter:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/downloadDataset.html">downloadDataset</a></span><span class="op">(</span>datasetName <span class="op">=</span> <span class="st">"GiBleed"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>You can check which are the downloaded datasets with
<code><a href="../reference/datasetStatus.html">datasetStatus()</a></code> in this case we will see that
<em>GiBleed</em> is the only one that has been downloaded:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/datasetStatus.html">datasetStatus</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> GiBleed</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> empty_cdm</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synpuf-1k_5.3</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synpuf-1k_5.4</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-allergies-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-anemia-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-breast_cancer-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-contraceptives-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-covid19-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-covid19-200k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-dermatitis-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-heart-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-hiv-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-lung_cancer-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-medications-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-metabolic_syndrome-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-opioid_addiction-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-rheumatoid_arthritis-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-snf-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-surgery-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-total_joint_replacement-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-veteran_prostate_cancer-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-veterans-10k</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> synthea-weight_loss-10k</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-a-cdm-reference">Create a cdm reference<a class="anchor" aria-label="anchor" href="#create-a-cdm-reference"></a>
</h2>
<p>You can create <em>temporary</em> cdm_reference objects with the
<code><a href="../reference/cdmFromDataset.html">cdmFromDataset()</a></code> function, this function will create a
temporary <em>duckdb</em> database in duckdb with two schemas
<strong>main</strong> (cdmSchema) and <strong>results</strong>
(writeSchema).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cdmFromDataset.html">cdmFromDataset</a></span><span class="op">(</span>datasetName <span class="op">=</span> <span class="st">"GiBleed"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: method with signature 'DBIConnection#Id' chosen for function 'dbExistsTable',</span></span>
<span><span class="co">#&gt;  target signature 'duckdb_connection#Id'.</span></span>
<span><span class="co">#&gt;  "duckdb_connection#ANY" would also be valid</span></span>
<span><span class="va">cdm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;"># OMOP CDM reference (duckdb) of GiBleed</span> <span style="color: #00BBBB;">────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">omop tables:</span> person, observation_period, visit_occurrence, visit_detail,</span></span>
<span><span class="co">#&gt; condition_occurrence, drug_exposure, procedure_occurrence, device_exposure,</span></span>
<span><span class="co">#&gt; measurement, observation, death, note, note_nlp, specimen, fact_relationship,</span></span>
<span><span class="co">#&gt; location, care_site, provider, payer_plan_period, cost, drug_era, dose_era,</span></span>
<span><span class="co">#&gt; condition_era, metadata, cdm_source, concept, vocabulary, domain,</span></span>
<span><span class="co">#&gt; concept_class, concept_relationship, relationship, concept_synonym,</span></span>
<span><span class="co">#&gt; concept_ancestor, source_to_concept_map, drug_strength</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">cohort tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">achilles tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other tables:</span> -</span></span></code></pre></div>
<p>This function is intended for temporary use of those databases as any
modification to this database will disappear after you close the
connection to the cdm. If you want to export a database that you want to
use please use <code><a href="../reference/exportDatasetToDuckdb.html">exportDatasetToDuckdb()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="export-a-dataset">Export a dataset<a class="anchor" aria-label="anchor" href="#export-a-dataset"></a>
</h2>
<p>You can export the dataset and create a duckdb connection using the
<code><a href="../reference/exportDatasetToDuckdb.html">exportDatasetToDuckdb()</a></code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"my_db"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/exportDatasetToDuckdb.html">exportDatasetToDuckdb</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span>, datasetName <span class="op">=</span> <span class="st">"GiBleed"</span><span class="op">)</span></span></code></pre></div>
<p>Note that the exported <code>.duckdb</code> file has an associated
METADATA file with the export datails:</p>
<pre><code><span><span class="co">#&gt; datasetName: GiBleed</span></span>
<span><span class="co">#&gt; type: database</span></span>
<span><span class="co">#&gt; dbDir: /tmp/Rtmph7LNiC/my_db/GiBleed.duckdb</span></span>
<span><span class="co">#&gt; dbms: duckdb</span></span>
<span><span class="co">#&gt; cdmName: GiBleed</span></span>
<span><span class="co">#&gt; cdmVersion: 5.3</span></span>
<span><span class="co">#&gt; cdmSchema: main</span></span>
<span><span class="co">#&gt; writeSchema: results</span></span></code></pre>
<p>Once you have exported your dataset you can connect using the usual
<em>CDMConnector</em> function and it works as any other database:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: DBI</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span>drv <span class="op">=</span> <span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span>dbdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"GiBleed.duckdb"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">cdmFromCon</a></span><span class="op">(</span>con <span class="op">=</span> <span class="va">con</span>, cdmSchema <span class="op">=</span> <span class="st">"main"</span>, writeSchema <span class="op">=</span> <span class="st">"results"</span>, cdmName <span class="op">=</span> <span class="st">"GiBleed"</span><span class="op">)</span></span>
<span><span class="va">cdm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;"># OMOP CDM reference (duckdb) of GiBleed</span> <span style="color: #00BBBB;">────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">omop tables:</span> person, observation_period, visit_occurrence, visit_detail,</span></span>
<span><span class="co">#&gt; condition_occurrence, drug_exposure, procedure_occurrence, device_exposure,</span></span>
<span><span class="co">#&gt; measurement, observation, death, note, note_nlp, specimen, fact_relationship,</span></span>
<span><span class="co">#&gt; location, care_site, provider, payer_plan_period, cost, drug_era, dose_era,</span></span>
<span><span class="co">#&gt; condition_era, metadata, cdm_source, concept, vocabulary, domain,</span></span>
<span><span class="co">#&gt; concept_class, concept_relationship, relationship, concept_synonym,</span></span>
<span><span class="co">#&gt; concept_ancestor, source_to_concept_map, drug_strength</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">cohort tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">achilles tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other tables:</span> -</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martí Català.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
